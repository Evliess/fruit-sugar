<div class="page-wrapper">
    <div class="container">

        @if (currIndex > 0) {
        <div class="prev-word-preview" (click)="handleAction('prev')">
            <span nz-icon nzType="arrow-left" nzTheme="outline" class="back-arrow"></span>
            <div class="preview-content">
                <div class="prev-word-text">{{ words[currIndex - 1].word }}</div>
                <div class="prev-phonetic">/{{ soundTypeUK ? words[currIndex - 1].ukAudio : words[currIndex - 1].usAudio
                    }}/</div>
                <div class="prev-def">{{ getShortDefinition(words[currIndex - 1]) }}</div>
            </div>
        </div>
        }

        <div nz-row nzJustify="end" class="top-bar">
            <nz-space [nzSize]="12">
                <nz-tag nzColor="#0071e3" class="home-tag" (click)="goHome()">首页</nz-tag>
                <nz-switch *nzSpaceItem [(ngModel)]="isEyeOpen" nzCheckedChildren="听写开" nzUnCheckedChildren="听写关"
                    nzSize="default" />
                <nz-switch *nzSpaceItem [(ngModel)]="soundEnabled" nzCheckedChildren="音效开" nzUnCheckedChildren="音效关"
                    nzSize="default" />
                <nz-switch *nzSpaceItem nz-button [(ngModel)]="soundTypeUK" nzCheckedChildren="英式"
                    nzUnCheckedChildren="美式" nzSize="default" />
                <a nz-dropdown *nzSpaceItem nzTrigger="click" [nzDropdownMenu]="menu" class="dropdown-link">
                    <nz-tag nzColor="#0071e3">全部 <nz-icon nzType="down" /></nz-tag>
                </a>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                    <ul nz-menu class="word-list">
                        @for(item of words; track $index) {
                        <li nz-menu-item
                            (click)="currIndex=$index; currWord=item; getSentenceWithGap(); playAudio(item)"
                            [nzSelected]="currIndex==$index">
                            {{item.word}}; {{getShortDefinition(item)}}
                        </li>
                        }
                    </ul>
                </nz-dropdown-menu>
            </nz-space>
        </div>

        <main class="main-content">
            @if(isEyeOpen) {
            <div class="sentence-stage">
                <p class="en-sentence">
                    @if (sentenceParts) {
                    {{sentenceParts.before}}
                    @if (hasError) {
                    <span class="correct-answer">{{sentenceParts.word}}</span>
                    } @else {
                    <span class="single-line-gap"></span>
                    }
                    {{sentenceParts.after}}
                    }
                </p>
            </div>
            }

            @if(currWord) {
            <div class="interactive-stage">
                <div class="input-container">
                    <input nz-input [(ngModel)]="inputValue" [appMechanicalTyping]="soundEnabled" [class]="inputStatus"
                        (keydown.enter)="checkAnswer()" (click)="onInputClick(); sound()" class="clean-input"
                        placeholder="" />
                    <div class="input-underline" [class.success]="inputStatus.includes('success')"></div>
                </div>
                @if(isEyeOpen) {
                <div class="phonetic-row">
                    {{ soundTypeUK ? currWord.ukAudio : currWord.usAudio }}
                </div>

                <div class="definition-row">
                    @for (item of currWord.definitions | keyvalue; track item.key; let f = $first) {
                    @if(f) {
                    <span class="pos-label">{{ item.key }}.</span>
                    <span class="meaning-label">{{ item.value }}</span>
                    }
                    }
                </div>}

                <button nz-button nzType="text" class="audio-trigger-btn" (click)="sound()">
                    <span nz-icon nzType="sound" nzTheme="outline"></span>
                </button>
            </div>
            }
        </main>

        <footer class="bottom-area">
            <div class="nav-hint-row">
                <button nz-button nzType="text" (click)="handleAction('next')" class="next-hint">
                    <span nz-icon nzType="arrow-right"></span> 下一个单词
                </button>
            </div>

            <div class="progress-container">
                <nz-progress [nzPercent]="((currIndex + 1) / words.length) * 100" [nzShowInfo]="false"
                    [nzStrokeWidth]="3" nzStrokeColor="#ff7a45"></nz-progress>
                <div class="progress-count">{{currIndex + 1}}/{{words.length}}</div>
            </div>
        </footer>
    </div>
</div>