<div class="container">
  <div class="list-container">
    @if(isCustom) {
    <div class="custom-input-section">
      <input nz-input [(ngModel)]="userWord" placeholder="è¾“å…¥è‡ªå®šä¹‰å•è¯..." />
      <button nz-button nzType="primary" (click)="customWord(userWord)" [nzLoading]="isLoading" nz-tooltip
        nzTooltipTitle="æ·»åŠ ">
        <span nz-icon nzType="plus"></span> æ·»åŠ 
      </button>
    </div>
    }
    
    <div nz-row [nzGutter]="[16, 16]">
      @for (item of firstWords; track item.id) {
      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="8" [nzXl]="8" [nzXXl]="8">
        <nz-card 
          [class.is-known]="item.isKnown" 
          [nzHoverable]="true"
          appHoverSound 
          (soundClick)="handleSound('US', item)">
          
          <!-- å¡ç‰‡å†…å®¹åŒºåŸŸ -->
          <div class="card-content">
            <!-- å•è¯æ ‡é¢˜ -->
            <div class="word-title-group">
              <span class="word-text">{{ item.word }}</span>
              @if (item.isKnown) {
              <nz-tag [nzColor]="'success'">å·²æŒæ¡</nz-tag>
              }
            </div>

            <!-- éŸ³æ ‡ -->
            <div class="phonetic-group">
              <strong>ğŸ‡ºğŸ‡¸ </strong><span class="phonetic">{{ item.usPhonetic }} <nz-icon class="sound-icon"
                  nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                  (hoverTimeout)="handleSound('US', item)" /></span>
              <strong>ğŸ‡¬ğŸ‡§ </strong><span class="phonetic">{{ item.ukPhonetic }} <nz-icon class="sound-icon"
                  nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                  (hoverTimeout)="handleSound('UK', item)" /></span>
            </div>

            <!-- é‡Šä¹‰ -->
            @if (!(item.showDetails || ciHuiService.learnMode())) {
            <div class="definition">{{item.sentences[0]?.text || ''}}</div>
            }

            @if (item.showDetails || ciHuiService.learnMode()) {
            <div class="definition-details">
              @for (def of item.definition | keyvalue; track def.key) {
              <div class="definition-item"><strong>{{ def.key }}:</strong> {{ def.value }}</div>
              }
            </div>
            }

            <!-- è¯¦æƒ…åŒºåŸŸ -->
            @if (item.showDetails || ciHuiService.learnMode()) {
            <div class="card-details">
              <nz-divider></nz-divider>

              <div class="detail-block">
                <span class="detail-label">å¸¸ç”¨è¯ç»„ï¼š</span>
                <div class="detail-content">
                  @for (phrase of item.phrases; track $index) {
                  <nz-tag>{{ phrase }}</nz-tag>
                  }
                </div>
              </div>

              <div class="detail-block mt-2">
                <span class="detail-label">åŒè¯­ä¾‹å¥ï¼š</span>
                <div class="detail-content sentence-list">
                  @for (sent of item.sentences; track $index) {
                  <div class="sentence-item">
                    <p class="en">{{ sent.text }}</p>
                    <p class="zh">{{ sent.textTranslation }}</p>
                  </div>
                  }
                </div>
              </div>
            </div>
            }
          </div>

          <!-- å¡ç‰‡åº•éƒ¨æ“ä½œæŒ‰é’® -->
          <div class="card-footer">
            @if(!isCustom) {
            <button nz-button nzType="text" [nzType]="item.isKnown ? 'primary' : 'default'" [nzGhost]="item.isKnown"
              (click)="$event.stopPropagation();markAsKnown(item)" nz-tooltip nzTooltipTitle="æ ‡è®°ä¸ºè®¤è¯†">
              <span nz-icon nzType="check"></span> è®¤è¯†
            </button>

            <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();markAsUnknown(item)" nz-tooltip
              nzTooltipTitle="æ ‡è®°ä¸ºä¸è®¤è¯†">
              <span nz-icon nzType="close"></span> ä¸è®¤è¯†
            </button>
            }

            @if(!ciHuiService.learnMode()) {
            <button nz-button nzType="default" (click)="$event.stopPropagation();toggleDetails(item)">
              <span nz-icon [nzType]="item.showDetails|| ciHuiService.learnMode() ? 'up' : 'down'"></span>
              {{ item.showDetails || ciHuiService.learnMode()? 'æ”¶èµ·' : 'è¯¦æƒ…' }}
            </button>
            }

            @if(isCustom) {
            <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();deleteCustomBook(item)" nz-tooltip
              nzTooltipTitle="åˆ é™¤">
              <span nz-icon nzType="delete"></span> åˆ é™¤
            </button>
            }
          </div>
        </nz-card>
      </div>
      }

      @defer (on timer(20ms)) {
      @for (item of remainingWords; track item.id) {
      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="8" [nzXl]="8" [nzXXl]="8">
        <nz-card 
          [class.is-known]="item.isKnown" 
          [nzHoverable]="true"
          appHoverSound 
          (soundClick)="handleSound('US', item)">
          
          <!-- å¡ç‰‡å†…å®¹åŒºåŸŸ -->
          <div class="card-content">
            <!-- å•è¯æ ‡é¢˜ -->
            <div class="word-title-group">
              <span class="word-text">{{ item.word }}</span>
              @if (item.isKnown) {
              <nz-tag [nzColor]="'success'">å·²æŒæ¡</nz-tag>
              }
            </div>

            <!-- éŸ³æ ‡ -->
            <div class="phonetic-group">
              <strong>ğŸ‡ºğŸ‡¸ </strong><span class="phonetic">{{ item.usPhonetic }} <nz-icon class="sound-icon"
                  nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                  (hoverTimeout)="handleSound('US', item)" /></span>
              <strong>ğŸ‡¬ğŸ‡§ </strong><span class="phonetic">{{ item.ukPhonetic }} <nz-icon class="sound-icon"
                  nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                  (hoverTimeout)="handleSound('UK', item)" /></span>
            </div>

            <!-- é‡Šä¹‰ -->
            @if (!(item.showDetails || ciHuiService.learnMode())) {
            <div class="definition">{{item.sentences[0]?.text || ''}}</div>
            }

            @if (item.showDetails || ciHuiService.learnMode()) {
            <div class="definition-details">
              @for (def of item.definition | keyvalue; track def.key) {
              <div class="definition-item"><strong>{{ def.key }}:</strong> {{ def.value }}</div>
              }
            </div>
            }

            <!-- è¯¦æƒ…åŒºåŸŸ -->
            @if (item.showDetails || ciHuiService.learnMode()) {
            <div class="card-details">
              <nz-divider></nz-divider>

              <div class="detail-block">
                <span class="detail-label">å¸¸ç”¨è¯ç»„ï¼š</span>
                <div class="detail-content">
                  @for (phrase of item.phrases; track $index) {
                  <nz-tag>{{ phrase }}</nz-tag>
                  }
                </div>
              </div>

              <div class="detail-block mt-2">
                <span class="detail-label">åŒè¯­ä¾‹å¥ï¼š</span>
                <div class="detail-content sentence-list">
                  @for (sent of item.sentences; track $index) {
                  <div class="sentence-item">
                    <p class="en">{{ sent.text }}</p>
                    <p class="zh">{{ sent.textTranslation }}</p>
                  </div>
                  }
                </div>
              </div>
            </div>
            }
          </div>

          <!-- å¡ç‰‡åº•éƒ¨æ“ä½œæŒ‰é’® -->
          <div class="card-footer">
            @if(!isCustom) {
            <button nz-button nzType="text" [nzType]="item.isKnown ? 'primary' : 'default'" [nzGhost]="item.isKnown"
              (click)="$event.stopPropagation();markAsKnown(item)" nz-tooltip nzTooltipTitle="æ ‡è®°ä¸ºè®¤è¯†">
              <span nz-icon nzType="check"></span> è®¤è¯†
            </button>

            <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();markAsUnknown(item)" nz-tooltip
              nzTooltipTitle="æ ‡è®°ä¸ºä¸è®¤è¯†">
              <span nz-icon nzType="close"></span> ä¸è®¤è¯†
            </button>
            }

            @if(!ciHuiService.learnMode()) {
            <button nz-button nzType="default" (click)="$event.stopPropagation();toggleDetails(item)">
              <span nz-icon [nzType]="item.showDetails|| ciHuiService.learnMode() ? 'up' : 'down'"></span>
              {{ item.showDetails || ciHuiService.learnMode()? 'æ”¶èµ·' : 'è¯¦æƒ…' }}
            </button>
            }

            @if(isCustom) {
            <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();deleteCustomBook(item)" nz-tooltip
              nzTooltipTitle="åˆ é™¤">
              <span nz-icon nzType="delete"></span> åˆ é™¤
            </button>
            }
          </div>
        </nz-card>
      </div>
      }
      }
    </div>
  </div>

  <!-- ç»ƒä¸€ç»ƒ å¼¹çª— (ä¿æŒä¸å˜) -->
  <nz-modal [(nzVisible)]="isPracticeVisible" [nzTitle]="'æ‹¼å†™ç»ƒä¹ '" (nzOnCancel)="handlePracticeCancel()"
    (nzOnOk)="handlePracticeOk()">
    <ng-container *nzModalContent>
      @for (item of practiceWord?.definition | keyvalue; track item.key) {
      <div class="definition">{{ item.value }}</div>
      }
      <input nz-input placeholder="è¾“å…¥å•è¯..." [(ngModel)]="practiceInput" (keydown.enter)="handlePracticeOk()" />
    </ng-container>
  </nz-modal>
</div>