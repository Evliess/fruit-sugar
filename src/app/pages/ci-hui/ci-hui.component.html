<div class="container">
  <!-- <div class="page-header">
    <h1>è¯æ±‡æ‰“å¡</h1>
  </div> -->

  <div class="list-container">
    @if(isCustom) {
    <div class="word-row">
      <div class="row-main">
        <div class="word-info">
          <input nz-input [(ngModel)]="userWord" />
        </div>
        <div class="action-group">
          <button nz-button nzType="primary" (click)="customWord(userWord)" [nzLoading]="isLoading" nz-tooltip
            nzTooltipTitle="æ·»åŠ ">
            <span nz-icon nzType="plus"></span> æ·»åŠ 
          </button>
        </div>
      </div>
    </div>
    }
    @for (item of words.slice(0, 10); track item.id) {
    <!-- å•ä¸ªå•è¯è¡Œ -->
    <div class="word-row" [class.is-known]="item.isKnown" appHoverSound (soundClick)="handleSound('US', item)">

      <!-- ä¸ŠåŠéƒ¨åˆ†ï¼šä¸»è¦ä¿¡æ¯ + æ“ä½œæŒ‰é’® -->
      <div class="row-main">

        <!-- å·¦ä¾§ï¼šå•è¯ä¿¡æ¯ -->
        <div class="word-info">
          <div class="word-title-group">
            <span class="word-text">{{ item.word }}</span>
            @if (item.isKnown) {
            <!-- <nz-tag [nzColor]="'success'">å·²æŒæ¡</nz-tag> -->
            }
          </div>

          <div class="phonetic-group">
            <strong>ğŸ‡ºğŸ‡¸ </strong><span class="phonetic">{{ item.usPhonetic }} <nz-icon class="sound-icon"
                nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                (hoverTimeout)="handleSound('US', item)" /></span>
            <strong>ğŸ‡¬ğŸ‡§ </strong><span class="phonetic">{{ item.ukPhonetic }} <nz-icon class="sound-icon"
                nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                (hoverTimeout)="handleSound('UK', item)" /></span>
          </div>

          @if (!(item.showDetails || ciHuiService.learnMode())) {
          <div class="definition">{{item.sentences[0].text}}</div>
          }

          @if (item.showDetails || ciHuiService.learnMode()) {
          @for (item of item.definition | keyvalue; track item.key) {
          <div class="definition"><strong>{{ item.key }}:</strong> {{ item.value }}</div>
          }
          }
        </div>

        <!-- å³ä¾§ï¼šæŒ‰é’®ç»„ -->
        <div class="action-group">
          <!-- è®¤è¯† -->
           @if(!isCustom) {
          <button nz-button nzType="text" [nzType]="item.isKnown ? 'primary' : 'default'" [nzGhost]="item.isKnown"
            (click)="$event.stopPropagation();markAsKnown(item)" nz-tooltip nzTooltipTitle="æ ‡è®°ä¸ºè®¤è¯†">
            <span nz-icon nzType="check"></span> è®¤è¯†
          </button>

          <!-- ä¸è®¤è¯† -->
          <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();markAsUnknown(item)" nz-tooltip
            nzTooltipTitle="æ ‡è®°ä¸ºä¸è®¤è¯†">
            <span nz-icon nzType="close"></span> ä¸è®¤è¯†
          </button>
          }

          <!-- æ˜¾ç¤ºå…¨éƒ¨/æ”¶èµ· -->
          @if(!ciHuiService.learnMode()) {
          <button nz-button nzType="default" (click)="$event.stopPropagation();toggleDetails(item)">
            <span nz-icon [nzType]="item.showDetails|| ciHuiService.learnMode() ? 'up' : 'down'"></span>
            {{ item.showDetails || ciHuiService.learnMode()? 'æ”¶èµ·' : 'è¯¦æƒ…' }}
          </button>

          <!-- ç»ƒä¸€ç»ƒ -->
          <!-- <button nz-button nzType="primary" (click)="$event.stopPropagation();openPractice(item)">
            <span nz-icon nzType="edit"></span> ç»ƒä¸€ç»ƒ
          </button> -->
          }
          @if(isCustom) {
          <!-- åˆ é™¤ -->
          <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();deleteCustomBook(item)" nz-tooltip
            nzTooltipTitle="åˆ é™¤">
            <span nz-icon nzType="delete"></span> åˆ é™¤
          </button>
          }
        </div>
      </div>

      <!-- ä¸‹åŠéƒ¨åˆ†ï¼šè¯¦æƒ… (é»˜è®¤éšè—) -->
      @if (item.showDetails || ciHuiService.learnMode()) {
      <div class="row-details">
        <nz-divider></nz-divider>

        <div class="detail-block">
          <span class="detail-label">å¸¸ç”¨è¯ç»„ï¼š</span>
          <div class="detail-content">
            @for (phrase of item.phrases; track $index) {
            <nz-tag>{{ phrase }}</nz-tag>
            }
          </div>
        </div>

        <div class="detail-block mt-2">
          <span class="detail-label">åŒè¯­ä¾‹å¥ï¼š</span>
          <div class="detail-content sentence-list">
            @for (sent of item.sentences; track $index) {
            <div class="sentence-item">
              <p class="en">{{ sent.text }}</p>
              <p class="zh">{{ sent.textTranslation }}</p>
            </div>
            }
          </div>
        </div>
      </div>
      }
    </div>
    }
    @defer (on timer(50ms)) {
    @for (item of words.slice(10); track item.id) {
    <!-- å•ä¸ªå•è¯è¡Œ -->
    <div class="word-row" [class.is-known]="item.isKnown" appHoverSound (soundClick)="handleSound('US', item)">

      <!-- ä¸ŠåŠéƒ¨åˆ†ï¼šä¸»è¦ä¿¡æ¯ + æ“ä½œæŒ‰é’® -->
      <div class="row-main">

        <!-- å·¦ä¾§ï¼šå•è¯ä¿¡æ¯ -->
        <div class="word-info">
          <div class="word-title-group">
            <span class="word-text">{{ item.word }}</span>
            @if (item.isKnown) {
            <!-- <nz-tag [nzColor]="'success'">å·²æŒæ¡</nz-tag> -->
            }
          </div>

          <div class="phonetic-group">
            <strong>ğŸ‡ºğŸ‡¸ </strong><span class="phonetic">{{ item.usPhonetic }} <nz-icon class="sound-icon"
                nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                (hoverTimeout)="handleSound('US', item)" /></span>
            <strong>ğŸ‡¬ğŸ‡§ </strong><span class="phonetic">{{ item.ukPhonetic }} <nz-icon class="sound-icon"
                nzType="muted" nzTheme="outline" appHoverSound [hoverTime]="100"
                (hoverTimeout)="handleSound('UK', item)" /></span>
          </div>

          @if (!(item.showDetails || ciHuiService.learnMode())) {
          <div class="definition">{{item.sentences[0].text}}</div>
          }

          @if (item.showDetails || ciHuiService.learnMode()) {
          @for (item of item.definition | keyvalue; track item.key) {
          <div class="definition"><strong>{{ item.key }}:</strong> {{ item.value }}</div>
          }
          }
        </div>

        <!-- å³ä¾§ï¼šæŒ‰é’®ç»„ -->
        <div class="action-group">
          <!-- è®¤è¯† -->
          @if(!isCustom) {
          <button nz-button nzType="text" [nzType]="item.isKnown ? 'primary' : 'default'" [nzGhost]="item.isKnown"
            (click)="$event.stopPropagation();markAsKnown(item)" nz-tooltip nzTooltipTitle="æ ‡è®°ä¸ºè®¤è¯†">
            <span nz-icon nzType="check"></span> è®¤è¯†
          </button>

          <!-- ä¸è®¤è¯† -->
          <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();markAsUnknown(item)" nz-tooltip
            nzTooltipTitle="æ ‡è®°ä¸ºä¸è®¤è¯†">
            <span nz-icon nzType="close"></span> ä¸è®¤è¯†
          </button>
          }


          <!-- æ˜¾ç¤ºå…¨éƒ¨/æ”¶èµ· -->
          @if(!ciHuiService.learnMode()) {
          <button nz-button nzType="default" (click)="$event.stopPropagation();toggleDetails(item)">
            <span nz-icon [nzType]="item.showDetails|| ciHuiService.learnMode() ? 'up' : 'down'"></span>
            {{ item.showDetails || ciHuiService.learnMode()? 'æ”¶èµ·' : 'è¯¦æƒ…' }}
          </button>

          <!-- ç»ƒä¸€ç»ƒ -->
          <!-- <button nz-button nzType="primary" (click)="$event.stopPropagation();openPractice(item)">
            <span nz-icon nzType="edit"></span> ç»ƒä¸€ç»ƒ
          </button> -->
          }
           @if(isCustom) {
          <!-- åˆ é™¤ -->
          <button nz-button nzType="default" nzDanger (click)="$event.stopPropagation();deleteCustomBook(item)" nz-tooltip
            nzTooltipTitle="åˆ é™¤">
            <span nz-icon nzType="delete"></span> åˆ é™¤
          </button>
          }
        </div>
      </div>

      <!-- ä¸‹åŠéƒ¨åˆ†ï¼šè¯¦æƒ… (é»˜è®¤éšè—) -->
      @if (item.showDetails || ciHuiService.learnMode()) {
      <div class="row-details">
        <nz-divider></nz-divider>

        <div class="detail-block">
          <span class="detail-label">å¸¸ç”¨è¯ç»„ï¼š</span>
          <div class="detail-content">
            @for (phrase of item.phrases; track $index) {
            <nz-tag>{{ phrase }}</nz-tag>
            }
          </div>
        </div>

        <div class="detail-block mt-2">
          <span class="detail-label">åŒè¯­ä¾‹å¥ï¼š</span>
          <div class="detail-content sentence-list">
            @for (sent of item.sentences; track $index) {
            <div class="sentence-item">
              <p class="en">{{ sent.text }}</p>
              <p class="zh">{{ sent.textTranslation }}</p>
            </div>
            }
          </div>
        </div>
      </div>
      }
    </div>
    }
    }
  </div>

  <!-- ç»ƒä¸€ç»ƒ å¼¹çª— (ä¿æŒä¸å˜) -->
  <nz-modal [(nzVisible)]="isPracticeVisible" [nzTitle]="'æ‹¼å†™ç»ƒä¹ '" (nzOnCancel)="handlePracticeCancel()"
    (nzOnOk)="handlePracticeOk()">
    <ng-container *nzModalContent>
      @for (item of practiceWord?.definition | keyvalue; track item.key) {
      <div class="definition">{{ item.value }}</div>
      }
      <input nz-input placeholder="è¾“å…¥å•è¯..." [(ngModel)]="practiceInput" (keydown.enter)="handlePracticeOk()" />
    </ng-container>
  </nz-modal>
</div>